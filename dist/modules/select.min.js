/**
 * angular-strap
 * @version v2.1.0 - 2015-01-28
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("mgcrea.ngStrap.select",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$select",function(){var e=this.defaults={animation:"am-fade",prefixClass:"select",prefixEvent:"$select",placement:"bottom-left",template:"select/select.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,multiple:!1,allNoneButtons:!1,sort:!0,caretHtml:'&nbsp;<span class="caret"></span>',placeholder:"Choose among the following...",maxLength:3,maxLengthHtml:"selected",iconCheckmark:"glyphicon glyphicon-ok",reloadEvents:[]};this.$get=["$window","$document","$rootScope","$tooltip",function(t,n,a,l){function i(t,n,a){var i={},o=angular.extend({},e,a);i=l(t,o);var r=i.$scope;r.$matches=[],r.$activeIndex=0,r.$isMultiple=o.multiple,r.$showAllNoneButtons=o.allNoneButtons&&o.multiple,r.$iconCheckmark=o.iconCheckmark,r.$activate=function(e){r.$$postDigest(function(){i.activate(e)})},r.$select=function(e){r.$$postDigest(function(){i.select(e)})},r.$isVisible=function(){return i.$isVisible()},r.$isActive=function(e){return i.$isActive(e)},r.$selectAll=function(){for(var e=0;e<r.$matches.length;e++)r.$isActive(e)||r.$select(e)},r.$selectNone=function(){for(var e=0;e<r.$matches.length;e++)r.$isActive(e)&&r.$select(e)},i.update=function(e){r.$matches=e,i.$updateActiveIndex()},i.activate=function(e){return o.multiple?(r.$activeIndex.sort(),i.$isActive(e)?r.$activeIndex.splice(r.$activeIndex.indexOf(e),1):r.$activeIndex.push(e),o.sort&&r.$activeIndex.sort()):r.$activeIndex=e,r.$activeIndex},i.select=function(e){var t=r.$matches[e].value;r.$apply(function(){i.activate(e),o.multiple?n.$setViewValue(r.$activeIndex.map(function(e){return r.$matches[e].value})):(n.$setViewValue(t),i.hide())}),r.$emit(o.prefixEvent+".select",t,e)},i.$updateActiveIndex=function(){n.$modelValue&&r.$matches.length?r.$activeIndex=o.multiple&&angular.isArray(n.$modelValue)?n.$modelValue.map(function(e){return i.$getIndex(e)}):i.$getIndex(n.$modelValue):r.$activeIndex>=r.$matches.length&&(r.$activeIndex=o.multiple?[]:0)},i.$isVisible=function(){return o.minLength&&n?r.$matches.length&&n.$viewValue.length>=o.minLength:r.$matches.length},i.$isActive=function(e){return o.multiple?-1!==r.$activeIndex.indexOf(e):r.$activeIndex===e},i.$getIndex=function(e){var t=r.$matches.length,n=t;if(t){for(n=t;n--&&r.$matches[n].value!==e;);if(!(0>n))return n}},i.$onMouseDown=function(e){if(e.preventDefault(),e.stopPropagation(),c){var t=angular.element(e.target);t.triggerHandler("click")}},i.$onKeyDown=function(e){if(/(9|13|38|40)/.test(e.keyCode)){if(e.preventDefault(),e.stopPropagation(),!o.multiple&&(13===e.keyCode||9===e.keyCode))return i.select(r.$activeIndex);38===e.keyCode&&r.$activeIndex>0?r.$activeIndex--:40===e.keyCode&&r.$activeIndex<r.$matches.length-1?r.$activeIndex++:angular.isUndefined(r.$activeIndex)&&(r.$activeIndex=0),r.$digest()}};var s=i.show;i.show=function(){s(),o.multiple&&i.$element.addClass("select-multiple"),setTimeout(function(){i.$element.on(c?"touchstart":"mousedown",i.$onMouseDown),o.keyboard&&t.on("keydown",i.$onKeyDown)})};var u=i.hide;return i.hide=function(){i.$element.off(c?"touchstart":"mousedown",i.$onMouseDown),o.keyboard&&t.off("keydown",i.$onKeyDown),u(!0)},i}var o=(angular.element(t.document.body),/(ip(a|o)d|iphone|android)/gi.test(t.navigator.userAgent)),c="createTouch"in t.document&&o;return i.defaults=e,i}]}).directive("bsSelect",["$window","$parse","$q","$select","$parseOptions",function(e,t,n,a,l){var i=a.defaults;return{restrict:"EAC",require:"ngModel",link:function(e,t,n,o){var c={scope:e};if(angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","placeholder","multiple","allNoneButtons","maxLength","maxLengthHtml","reloadEvents"],function(e){angular.isDefined(n[e])&&(c[e]=n[e])}),"select"===t[0].nodeName.toLowerCase()){var r=t;r.css("display","none"),t=angular.element('<button type="button" class="btn btn-default"></button>'),r.after(t)}var s=l(n.ngOptions),u=a(t,o,c),$=function(){s.valuesFn(e,o).then(function(e){u.update(e),o.$render()})},d=void 0===c.reloadEvents?i.reloadEvents:c.reloadEvents.replace(" ",",").split(",").filter(function(e){return""!==e.trim()});d.forEach(function(t){e.$root.$on(t,$)});var m=s.$match[7].replace(/\|.+/,"").trim();e.$watch(m,$,!0),e.$watch(n.ngModel,function(){u.$updateActiveIndex(),o.$render()},!0),n.$observe("placeholder",function(){o.$render()});var p=function(){try{return e.$eval(n.placeholder)||n.placeholder||i.placeholder}catch(t){return n.placeholder||i.placeholder}};o.$render=function(){var e,n;c.multiple&&angular.isArray(o.$modelValue)?(e=o.$modelValue.map(function(e){return n=u.$getIndex(e),angular.isDefined(n)?u.$scope.$matches[n].label:!1}).filter(angular.isDefined),e=e.length>(c.maxLength||i.maxLength)?e.length+" "+(c.maxLengthHtml||i.maxLengthHtml):e.join(", ")):(n=u.$getIndex(o.$modelValue),e=angular.isDefined(n)?u.$scope.$matches[n].label:!1),t.html((e?e:p())+i.caretHtml)},e.$on("$destroy",function(){u&&u.destroy(),c=null,u=null})}}}]);
//# sourceMappingURL=select.min.js.map